<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Custom GitHub Action | Hankeln Blog</title>
<meta name=description content="Personal blog by Luka Hankeln">
<link rel=stylesheet href=/css/styles.css>
<script>(function(){try{var a=localStorage.getItem('theme-preference');a==='dark'?document.documentElement.classList.add('theme-dark'):a==='light'?document.documentElement.classList.add('theme-light'):window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches&&document.documentElement.classList.add('theme-dark')}catch(a){}})()</script>
</head>
<body>
<header class=site-header>
<div class=inner>
<div style=display:flex;align-items:center;gap:1rem>
<h1 class=site-title><a href=/>Hankeln Blog</a></h1>
</div>
<div>
<button class=theme-toggle id=theme-toggle aria-label="Toggle dark mode">ðŸŒ™</button>
</div>
</div>
</header>
<main class=container>
<article class=post>
<h1>Custom GitHub Action</h1>
<p class=meta>May 12, 2025</p>
<div class=content>
<p>This guide explains how to create a simple custom GitHub Action that can be used to build or deploy a containerized app. It includes a minimal repository layout, corrected example files, build instructions and a sample workflow.</p>
<h2 id=overview>Overview</h2>
<ul>
<li>Goal: provide a reusable action that runs Node code packaged with ncc.</li>
<li>Output: a repository containing action.yml, a main script (index.js), and package.json. Build with ncc to produce dist/index.js.</li>
</ul>
<h2 id=prerequisites>Prerequisites</h2>
<ul>
<li>Node.js (for local development)</li>
<li>npm</li>
<li>Basic GitHub Actions knowledge</li>
</ul>
<h2 id=repository-layout>Repository layout</h2>
<ul>
<li>action.yml # Action metadata and inputs</li>
<li>index.js # Action implementation (source)</li>
<li>package.json # Dependencies and build step</li>
<li>dist/ # Built bundle (generated by npm run build)</li>
</ul>
<h2 id=files>Files</h2>
<ol>
<li>action.yml â€” metadata and inputs</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;deploy-container&#34;</span>
<span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Builds and deploys a container (example)&#34;</span>
<span style=color:#f92672>inputs</span>:
  <span style=color:#f92672>deploy</span>:
    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Whether to perform a deploy (true/false)&#34;</span>
    <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
    <span style=color:#f92672>default</span>: <span style=color:#e6db74>&#34;false&#34;</span>
  <span style=color:#f92672>image</span>:
    <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;Container image name (required if deploy=true)&#34;</span>
    <span style=color:#f92672>required</span>: <span style=color:#66d9ef>false</span>
<span style=color:#f92672>runs</span>:
  <span style=color:#f92672>using</span>: <span style=color:#e6db74>&#34;node20&#34;</span>
  <span style=color:#f92672>main</span>: <span style=color:#e6db74>&#34;dist/index.js&#34;</span>
</code></pre></div><ol start=2>
<li>index.js â€” minimal, robust implementation</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#75715e>// This is the source file; build with `npm run build` to produce dist/index.js
</span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>core</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@actions/core&#39;</span>);
<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>github</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>require</span>(<span style=color:#e6db74>&#39;@actions/github&#39;</span>);

<span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>run</span>() {
  <span style=color:#66d9ef>try</span> {
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>deploy</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#39;deploy&#39;</span>) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;true&#39;</span>;
    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>image</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#39;image&#39;</span>);

    <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`Action started. deploy=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>deploy</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, image=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>image</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#39;&lt;none&gt;&#39;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
    <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>`Event: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>github</span>.<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>eventName</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);

    <span style=color:#75715e>// Validate inputs
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>deploy</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>image</span>) {
      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Input &#34;image&#34; is required when deploy is true.&#39;</span>);
    }

    <span style=color:#75715e>// ... perform your logic here ...
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Example: build image, push, call an API to deploy, etc.
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Use environment secrets via process.env and core.getInput for safe access.
</span><span style=color:#75715e></span>
    <span style=color:#75715e>// Simulate async operation
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>await</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>) =&gt; <span style=color:#a6e22e>setTimeout</span>(<span style=color:#a6e22e>resolve</span>, <span style=color:#ae81ff>250</span>));

    <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#39;Operation completed successfully.&#39;</span>);
    <span style=color:#75715e>// Optionally set outputs:
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>setOutput</span>(<span style=color:#e6db74>&#39;deployed&#39;</span>, <span style=color:#a6e22e>deploy</span> <span style=color:#f92672>?</span> <span style=color:#e6db74>&#39;true&#39;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;false&#39;</span>);
  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>err</span>) {
    <span style=color:#75715e>// If the error is recoverable you can use core.warning
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>err</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>isWarn</span>) {
      <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>warning</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>||</span> String(<span style=color:#a6e22e>err</span>));
    } <span style=color:#66d9ef>else</span> {
      <span style=color:#a6e22e>core</span>.<span style=color:#a6e22e>setFailed</span>(<span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>message</span> <span style=color:#f92672>||</span> String(<span style=color:#a6e22e>err</span>));
    }
  }
}

<span style=color:#a6e22e>run</span>();
</code></pre></div><ol start=3>
<li>package.json â€” dependencies and build script</li>
</ol>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;deploy-container-action&#34;</span>,
  <span style=color:#f92672>&#34;version&#34;</span>: <span style=color:#e6db74>&#34;1.0.0&#34;</span>,
  <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;A simple GitHub Action that builds/deploys a container&#34;</span>,
  <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;index.js&#34;</span>,
  <span style=color:#f92672>&#34;dependencies&#34;</span>: {
    <span style=color:#f92672>&#34;@actions/core&#34;</span>: <span style=color:#e6db74>&#34;^1.11.1&#34;</span>,
    <span style=color:#f92672>&#34;@actions/github&#34;</span>: <span style=color:#e6db74>&#34;^6.0.1&#34;</span>
  },
  <span style=color:#f92672>&#34;scripts&#34;</span>: {
    <span style=color:#f92672>&#34;build&#34;</span>: <span style=color:#e6db74>&#34;npx @vercel/ncc build index.js -o dist&#34;</span>
  },
  <span style=color:#f92672>&#34;devDependencies&#34;</span>: {
    <span style=color:#f92672>&#34;@vercel/ncc&#34;</span>: <span style=color:#e6db74>&#34;^0.38.3&#34;</span>
  },
  <span style=color:#f92672>&#34;license&#34;</span>: <span style=color:#e6db74>&#34;MIT&#34;</span>
}
</code></pre></div><h2 id=building-the-action>Building the action</h2>
<ol>
<li>Install deps: <code>npm ci</code></li>
<li>Build the bundle: <code>npm run build</code></li>
<li>Commit the resulting dist directory (or produce it in your CI pipeline).</li>
</ol>
<h2 id=example-workflow-using-the-action>Example workflow using the action</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Example deploy</span>
<span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>deploy</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v4</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Use custom action</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>your-org/your-action-repo@v1</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>deploy</span>: <span style=color:#e6db74>&#34;true&#34;</span>
          <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#34;registry.example.com/your-image:latest&#34;</span>
        <span style=color:#75715e># secrets can be set in repository settings and passed automatically to the action via environment variables</span>
</code></pre></div><h2 id=tips--troubleshooting>Tips & troubleshooting</h2>
<ul>
<li>Keep secrets in GitHub Secrets (do not hard-code tokens).</li>
<li>Test your action locally with act or by running the workflow in a test repository.</li>
<li>Use core.info / core.warning / core.setFailed for clear logs and status.</li>
</ul>
<h2 id=further-reading>Further reading</h2>
<ul>
<li>GitHub Actions: creating actions: <a href=https://docs.github.com/actions/creating-actions>https://docs.github.com/actions/creating-actions</a></li>
<li>Packaging JavaScript actions with ncc: <a href=https://www.npmjs.com/package/@vercel/ncc>https://www.npmjs.com/package/@vercel/ncc</a></li>
</ul>
</div>
</article>
</main>
<footer class=site-footer>
<div class=inner>
<p>Â© 2025 Lukas Hankeln</p>
</div>
</footer>
<script src=/js/theme.js defer></script>
</body>
</html>